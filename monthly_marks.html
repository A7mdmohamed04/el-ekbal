<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600&display=swap" rel="stylesheet">
    <base target="_top">
    <title>Monthly Marks - ELS</title>
    <style>
        /* Reset CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Oswald;
            overscroll-behavior: none;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        /* Custom Fonts */
      
        :root {
            --primary-color: #003470;
            --secondary-color: #003470;
            --accent-color: #e74c3c;
            --light-color: #fff;
            --dark-color: #003470;
            font-family: 'Oswald', sans-serif;
        }

        body {
            font-family: 'Oswald', sans-serif;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .navbar {
            padding: 1.6rem 5%;
            position: fixed;
            width: 100%;
            z-index: 1000;
            transition: 0.3s;
            background: #003470;
            font-family: 'Oswald', sans-serif;
        }

        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            font-family: 'Oswald', sans-serif;
        }

        .logo {
            color: var(--light-color);
            font-size: 2rem;
            font-weight: 700;
            text-decoration: none;
            -webkit-tap-highlight-color: transparent;
            outline: none;
            font-family: 'Oswald', sans-serif;
            letter-spacing: 2px;
            font-size: 0;
            font-family: 'Oswald', sans-serif;
        }

        .logo-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            order: 2;
            font-family: 'Oswald', sans-serif;
        }

        .department-text {
            color: #808080;
            font-size: 0.8rem;
            margin-top: -5px;
            margin-left: 0px;
            display: none;
            font-family: 'Oswald', sans-serif;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            margin-right: 3rem;
            order: 1;
            font-family: 'Oswald', sans-serif;
        }

        .nav-links a {
            color: var(--light-color);
            text-decoration: none;
            font-weight: 500;
            font-family: Oswald;
        }

        .menu-btn {
            display: none;
            color: var(--light-color);
            font-size: 1.5rem;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0.5rem;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        .menu-btn .bar {
            display: block;
            width: 25px;
            height: 3px;
            margin: 5px auto;
            background-color: var(--light-color);
            transition: 0.3s;
        }

        .mobile-menu {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: #003470;
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out, padding 0.3s ease-in-out;
            text-align: center;
            display: flex;
            flex-direction: column;
        }

        .mobile-menu.active {
            max-height: 300px;
            padding: 1rem 0;
        }

        .mobile-menu a {
            display: block;
            color: var(--light-color);
            text-decoration: none;
            padding: 0.5rem 5%;
            font-weight: 500;
            font-family: 'Poppins', sans-serif;
        }

        .menu-btn.active .bar:nth-child(1) {
            transform: rotate(-45deg) translate(-5px, 6px);
        }

        .menu-btn.active .bar:nth-child(2) {
            opacity: 0;
        }

        .menu-btn.active .bar:nth-child(3) {
            transform: rotate(45deg) translate(-5px, -6px);
        }

        .home-icon, .teacher-icon {
            display: none;
            color: var(--light-color);
            font-size: 1.5rem;
            text-decoration: none;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        .teacher-icon {
            display: block;
            margin-left: auto;
            padding-right: 0;
        }

        .right-icons {
            order: 3;
            display: flex;
            align-items: center;
            gap: 2.5rem;
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 0.7rem 5%;
            }
            
            .nav-links {
                display: none;
            }
            
            .menu-btn {
                display: block;
                order: 3;
                transform: translateY(3.5px);
            }

            .home-icon {
                display: block;
                order: 2;
            }

            .teacher-icon {
                order: 1;
                margin-left: 0;
                transform: translateY(3px);
            }

            .logo {
                display: block;
                font-size: 1.8rem;
                letter-spacing: 6px;
                transform: translateY(7px);
            }

            .department-text {
                display: block;
                letter-spacing: 4px;
            }

            .logo-container {
                order: unset;
            }

            .nav-links {
                order: unset;
            }

            .right-icons {
                order: unset;
                gap: 1.2rem;
                margin-right: 10px;
            }
        }

        html, body {
            overflow: hidden;
            height: 100%;
            position: fixed;
            width: 100%;
            background: url('https://i.ibb.co/17sFJMQ/0000.png') no-repeat center center fixed;
            background-size: cover;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #003470;
            --secondary-color: #0084ff;
            --accent-color: #fff;
            --shadow-color: rgba(0, 123, 255, 0.3);
        }

        .main-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(0px);
        }

        @media (min-width: 769px) {
            .content-wrapper {
                margin-top: 40px;
            }
            
            .head-control {
                margin: 5px 0 !important; /* Decreased margin for desktop */
            }

            .button-group {
                margin-top: 0px; /* Decreased margin for desktop */
            }

            /* Adjust back and download buttons for Senior 1 and Senior 2 */
            .content-wrapper.senior .button-group {
                margin-top: 5px; /* Move up by 10px */
            }
        }

        .content-wrapper {
            position: relative;
            width: 100%;
            max-width: 450px;
            height: 460px; /* Fixed height */
            background: #f5f5f5;
            background-size: cover;
            border-radius: 20px;
            box-shadow: 0 20px 40px var(--shadow-color);
            overflow: hidden;
            animation: slideUp 0.8s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {opacity: 1;}
            to {opacity: 0;}
        }

        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }

        .circle-photo {
            width: 140px;
            height: 140px;
            position: relative;
            margin: 20px auto 10px;
            border-radius: 50%;
            padding: 8px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            box-shadow: 0 10px 20px var(--shadow-color);
            transition: opacity 0.5s ease;
        }

        .circle-photo img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            background: white;
            padding: 5px;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        .placeholder {
            padding: 0 20px 30px;
            text-align: center;
            height: 100%;
            overflow: hidden;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 320px;
            margin: 0 auto;
        }

        select, .code, .view {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid var(--primary-color);
            border-radius: 50px;
            font-size: 16px;
            color: var(--primary-color);
            background: white;
            transition: all 0.3s ease;
            text-align: center;
        }

        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23007bff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 20px;
            padding-right: 40px;
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
        }

        .view {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-weight: 600;
            border: none;
            cursor: pointer;
        }

        select:hover, .code:hover {
            border-color: var(--secondary-color);
            box-shadow: 0 5px 15px var(--shadow-color);
        }

        .view:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px var(--shadow-color);
        }

        .developers {
            margin-top: 20px;
            color: var(--primary-color);
            font-size: 14px;
            opacity: 0.8;
        }

        .monthly-marks {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin: 5px 0 15px;
            transition: opacity 0.5s ease;
        }

        .student-info {
            display: none;
            padding: 20px;
            background: white;
            border-radius: 20px;
            margin-top: 20px;
            animation: fadeIn 0.5s ease;
            overflow: hidden;
        }

        .student-name {
            width: 100%;
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 15px;
            padding: 8px;
            border-bottom: 1px solid #ccc;
            opacity: 0;
            animation: fadeIn 0.5s ease forwards;
        }

        .info-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* Changed to 2 columns */
            gap: 10px;
            margin-bottom: 15px;
        }

        .info-row > div {
            background: #cacacaab;
            color: black; /* Changed color to black */
            padding: 6px;
            border-radius: 25px;
            text-align: center;
            height: 35px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            opacity: 0;
        }

        /* Add this new style for second language div */
        .info-row > div.second-language {
            grid-column: span 2;
            height: 35px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            opacity: 0;
            animation: fadeIn 0.5s ease forwards 1s;
        }

        .back-btn, .download-btn {
            padding: 8px 16px;
            border-radius: 50px;
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            width: 100px; /* Added fixed width */
            background: #003470;
        }

        .head-control {
            text-align: center;
            margin: 15px 0;
            font-size: 14px;
            color: var(--primary-color);
            font-weight: 500;
            opacity: 0;
            animation: fadeIn 0.5s ease forwards 0.8s;
        }

        @media (max-width: 480px) {
            .content-wrapper {
                max-width: 100%;
                height: 450px; /* Reduced height */
            }

            .circle-photo {
                width: 150px; /* Increased size */
                height: 150px; /* Increased size */
                margin-top: 15px;
            }

            select, .code, .view {
                padding: 10px 15px;
                font-size: 14px;
            }

            .monthly-marks {
                font-size: 32px; /* Increased font size */
                margin: 5px 0 35px; /* Increased bottom margin */
            }
            
            .info-row {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .info-row > div {
                font-size: 11px;
                padding: 4px;
                height: 30px;
            }

            .form-group {
                gap: 10px;
                margin-top: -20px; /* Changed from 40px to -20px to move up */
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-links">
                <a href="index.html">Home</a> <span style="color: #d3d3d3;">/</span>
                <a href="timetable.html">Timetables</a> <span style="color: #d3d3d3;">/</span>
                <a href="Groups.html">Groups</a> <span style="color: #d3d3d3;">/</span>
                <a href="awards.html">Awards</a> <span style="color: #d3d3d3;">/</span>
                <a href="activities.html">Activities</a> <span style="color: #d3d3d3;">/</span>
                <a href="about.html">About</a>
            </div>
            <div class="logo-container">
                <a href="index.html" class="logo">EL EKBAL</a>
                <span class="department-text">BOYS DEPARTMENT</span>
            </div>
            <div class="right-icons">
                <a href="index.html" class="home-icon">
                    <i class="fas fa-home"></i>
                </a>
                <a href="teachers.html" class="teacher-icon fas fa-chalkboard-teacher"></a>
                <button class="menu-btn">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </button>
            </div>
        </div>
        <div class="mobile-menu">
            <a href="timetable.html">Timetables</a>
            <a href="Groups.html">Groups</a>
            <a href="awards.html">Awards</a>
            <a href="activities.html">Activities</a>
            <a href="about.html">About</a>
        </div>
    </nav>

    <div class="main-wrapper">
        <div class="content-wrapper">
            <div class="placeholder">
                <div class="circle-photo">
                    <img src="https://i.ibb.co/6NnmDDW/e-logo-01.png" alt="Logo" loading="eager" decoding="sync" fetchpriority="high">
                </div>
                <div class="monthly-marks">Monthly Marks</div>
                <div class="developers"></div>
                <div class="heading"></div>
                <?var url = getUrl();?>
                <form id="marksForm" class="form-group">
                    <select name='cl' required>
                        <option value="">Select Your Grade</option>
                        <option value="J4">Junior Four</option>
                        <option value="J5">Junior Five</option>
                        <option value="J6">Junior Six</option>
                        <option value="M1">Middle One</option>
                        <option value="M2">Middle Two</option>
                        <option value="S1">Senior One</option>
                        <option value="S2">Senior Two</option>
                    </select>
                    <input class="code" type="text" name="rl" placeholder="Enter Your Code" required>
                    <input class="view" type="submit" value="View" name="Submit">
                </form>
                <div class="student-info">
                    <div class="student-name"></div>
                    <div class="info-row"></div>
                    <div class="head-control"></div>
                    <div class="button-group">
                        <button class="back-btn">Back</button>
                        <button class="download-btn">Download</button>
                    </div>
                </div>
                <div class="developers"></div>
            </div>
        </div>
    </div>

    <script>
        const menuBtn = document.querySelector('.menu-btn');
        const mobileMenu = document.querySelector('.mobile-menu');
        const form = document.getElementById('marksForm');
        const studentInfo = document.querySelector('.student-info');
        const backBtn = document.querySelector('.back-btn');
        const downloadBtn = document.querySelector('.download-btn');
        const circlePhoto = document.querySelector('.circle-photo');
        const monthlyMarks = document.querySelector('.monthly-marks');
        const buttonGroup = document.querySelector('.button-group');
        const headControl = document.querySelector('.head-control');
        
        menuBtn.addEventListener('click', () => {
            menuBtn.classList.toggle('active');
            mobileMenu.classList.toggle('active');
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const grade = form.cl.value;
            const code = form.rl.value;

            if (grade === 'J4') {
                await fetchStudentData('j4.json', code, 'كود الطالب', 'اسم الطالب', true);
            } else if (grade === 'J5') {
                await fetchStudentData('j5.json', code, 'كود الطالب', 'اسم الطالب', true);
            } else if (grade === 'J6') {
                await fetchStudentData('j6.json', code, 'كود الطالب', 'اسم الطالب', true, true);
            } else if (grade === 'M1') {
                await fetchStudentData('m1.json', code, 'كود الطالب', 'اسم', false);
                headControl.textContent = 'Head of the control: Mr. Hassan Magdy Morsy';
                headControl.style.opacity = '0';
                headControl.style.animation = 'fadeIn 0.5s ease forwards 0.8s';
            } else if (grade === 'M2') {
                await fetchStudentData('m2.json', code, 'رقم جاوس', 'اسم', false);
                headControl.textContent = 'Head of the control: Mr. Hassan Magdy Morsy';
                headControl.style.opacity = '0';
                headControl.style.animation = 'fadeIn 0.5s ease forwards 0.8s';
            } else if (grade === 'S2') {
                await fetchStudentData('s2.json', code, 'كود الطالب', 'اسم الطالب', true);
                headControl.textContent = 'Head of the control: Ms. Nhaad El Masry';
                headControl.style.opacity = '0';
                headControl.style.animation = 'fadeIn 0.5s ease forwards 0.8s';
                document.querySelector('.content-wrapper').classList.add('senior');
            } else if (grade === 'S1') {
                await fetchStudentData('s1.json', code, 'رقم جاوس', 'اسم', true);
                headControl.textContent = 'Head of the control: Ms. Nhaad El Masry';
                headControl.style.opacity = '0';
                headControl.style.animation = 'fadeIn 0.5s ease forwards 0.8s';
                document.querySelector('.content-wrapper').classList.add('senior');
            }
        });

        async function fetchStudentData(jsonFile, code, codeKey = 'كود الطالب', nameKey = 'اسم الطالب', isColorBased = false, isJunior6 = false) {
            try {
                const response = await fetch(jsonFile);
                const data = await response.json();
                const student = data.find(s => s[codeKey] === code);

                if (student) {
                    form.style.animation = 'fadeOut 0.5s ease forwards';
                    circlePhoto.style.animation = 'fadeOut 0.5s ease forwards';
                    monthlyMarks.style.animation = 'fadeOut 0.5s ease forwards';
                    
                    setTimeout(() => {
                        form.style.display = 'none';
                        circlePhoto.style.display = 'none';
                        monthlyMarks.style.display = 'none';
                        studentInfo.style.display = 'block';
                        
                        const studentName = document.querySelector('.student-name');
                        studentName.textContent = student[nameKey];
                        studentName.style.animation = 'fadeIn 0.5s ease forwards';
                        
                        const infoRow = document.querySelector('.info-row');
                        infoRow.innerHTML = '';
                        
                        const subjects = Object.entries(student).filter(([key]) => 
                            key !== codeKey && key !== nameKey && key !== 'اللغة التانية' && key !== 'الدين'
                        );
                        
                        subjects.forEach(([subject, mark], index) => {
                            const div = document.createElement('div');
                            if (isJunior6 || isColorBased) {
                                div.style.backgroundColor = mark;
                                div.textContent = subject;
                            } else {
                                div.textContent = `${subject}: ${mark}`;
                                div.style.backgroundColor = '#cacacaab';
                            }
                            div.style.animation = `fadeIn 0.5s ease forwards ${0.5 + (index * 0.1)}s`;
                            infoRow.appendChild(div);
                        });

                        // Add second language with full width
                        if (student['اللغة التانية']) {
                            const secLangDiv = document.createElement('div');
                            secLangDiv.textContent = `اللغة التانية: ${student['اللغة التانية']}`;
                            secLangDiv.className = 'second-language';
                            secLangDiv.style.animation = `fadeIn 0.5s ease forwards ${0.5 + (subjects.length * 0.1)}s`;
                            infoRow.appendChild(secLangDiv);
                        }
                        if (student['الدين']) {
                            const religionDiv = document.createElement('div');
                            religionDiv.textContent = `الدين: ${student['الدين']}`;
                            religionDiv.style.animation = `fadeIn 0.5s ease forwards ${0.5 + ((subjects.length + 1) * 0.1)}s`;
                            infoRow.appendChild(religionDiv);
                        }
                    }, 500);
                } else {
                    alert('Invalid code');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error fetching student data');
            }
        }

        backBtn.addEventListener('click', () => {
            studentInfo.style.animation = 'fadeOut 0.5s ease forwards';
            setTimeout(() => {
                studentInfo.style.display = 'none';
                circlePhoto.style.display = 'block';
                monthlyMarks.style.display = 'block';
                circlePhoto.style.animation = 'fadeIn 0.5s ease forwards';
                monthlyMarks.style.animation = 'fadeIn 0.5s ease forwards';
                form.style.display = 'flex';
                form.style.animation = 'fadeIn 0.5s ease forwards';
                headControl.textContent = '';
                document.querySelector('.content-wrapper').classList.remove('senior');
            }, 500);
        });

        downloadBtn.addEventListener('click', () => {
            // Create a temporary container for capturing
            const tempContainer = document.createElement('div');
            tempContainer.style.background = 'white';
            tempContainer.style.padding = '20px';
            tempContainer.style.width = '450px';
            tempContainer.style.position = 'fixed';
            tempContainer.style.left = '-9999px';
            
            // Clone the student info content
            const studentInfoClone = document.querySelector('.student-info').cloneNode(true);
            
            // Remove the button group from the clone
            const buttonGroupClone = studentInfoClone.querySelector('.button-group');
            if (buttonGroupClone) {
                buttonGroupClone.remove();
            }
            
            tempContainer.appendChild(studentInfoClone);
            document.body.appendChild(tempContainer);
            
            html2canvas(tempContainer).then(canvas => {
                const link = document.createElement('a');
                link.download = 'student-marks.png';
                link.href = canvas.toDataURL();
                link.click();
                
                // Clean up
                document.body.removeChild(tempContainer);
            });
        });
    </script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</body>
</html>